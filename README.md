# Chinese-Speech-Recognition-Project
## Наши члены команды: 
- `Ян Тяньюй`: Локальное развертывание проекта
- `Фу Цзухэ`: Написание фреймворков и развертывание проектов в Docker
- `Ху Юйхан`：Ответственны за часть предобработки данных.
- `Шэнь Жуйцзи`：Ответственны за часть обучения модели.

## Набор данных и результаты обучения модели
#### Датасет: это [THCHS-30](https://www.openslr.org/18/), который является открытым китайским речевым корпусом, выпущенным [Центром технологий речи и языка (CSLT)](https://www.openslr.org/18/)) Тсиньхуаского университета.
#### Этот набор данных с речевыми данными был записан в тихой офисной среде, общая продолжительность записи превышает 30 часов. Частота дискретизации составляет 16 кГц, размер выборки — 16 бит.

![CER Plot](./plots/cer_epoch_50.png)

На приведенной выше диаграмме показано изменение CER (Character Error Rate) на валидационном наборе данных по мере прохождения эпох обучения.

### `requirements.txt`: 
```text
torch==1.6.0
Levenshtein==0.12.0
librosa==0.8.0
tensorboardX==2.1
ctcdecode==1.0.2
pycorrector==0.3.0 #Chinese Text Error Corrector
sounddevice==0.4.1
pyaudio==0.2.11
Flask==1.1.2
Flask-Cors==3.0.9
tqdm==4.50.2
joblib==1.0.0
werkzeug==1.0.0
gunicorn==20.0.4
```

---
---
## Предобработка данных （Ху Юйхан ）

### 1.1. `config.py`: Этот файл является конфигурационным файлом, в котором хранятся пути к данным, модели и т.д.
### 1.2. `data_preprocessing.py`: Этот скрипт читает данные и обрабатывает исходные данные, чтобы получить следующие три файла:
- `train.index`
- `dev.index`
- `labels.gz`
Файлы `train.index` и `dev.index` являются индексными файлами, которые представляют собой соответствие между аудиофайлами и их аннотациями.
Файл `labels.gz` является сжатым файлом, содержащим все символы, которые встречаются в аннотациях данных, представленных в виде списка.
### 1.3. `processing_labels_gz.ipynb`: Этот файл предназначен для обработки labels.gz и удаления всех символов, кроме китайских.

---
---
## Модельное обучение 50 epochs ( Шэнь Жуйцзи)

### 1. файл обучения модели
#### 1.1. `train.py`: Этот код является основным кодом, который обучает модель на основе GatedConv и одновременно вычисляет и выводит кривую CER (коэффициент ошибок символов).
#### 1.2. `data.py`: В этом коде осуществляется подготовка и загрузка данных, необходимых для задачи.
#### 1.3. `feature.py`: Загрузка аудиофайла и его преобразование в логарифмическую амплитудную спектрограмму (log-magnitude spectrogram).
#### 1.4. `decoder.py`: Определение класса Decoder и его подкласса GreedyDecoder для обработки задач декодирования в речевом распознавании.

### 2. Папка
#### 2.1. Папка `processed`:В этой папке хранятся файлы после предобработки, включая:train.index,dev.index,labels.gz.
#### 2.2. Папка `pretrained`:В этой папке хранятся модели после обучения.
#### 2.3. Папка `plots`:В этой папке хранятся графики результатов CER (Character Error Rate).
#### 2.4. Папка `data`:В этой папке хранятся исходные наборы данных:
- `train` (тренировочный набор)
- `dev` (набор для валидации)
#### 2.5. Папка `models`:В данной папке определены модель, её обучение и оценка.

---
---
## Развертывание проекта ( Ян Тяньюй )
### 1. Файл для работы проекта
#### 1.1. masr_server.py
Этот файл является основным кодом проекта, который выполняет следующие задачи:

Обрабатывает аудиофайлы, загруженные пользователем через веб-интерфейс.
Сохраняет загруженные аудиофайлы в папку save_audio/.
Вызывает предобученную модель для распознавания речи и возвращает результат в виде текста.

#### 1.2. config.py
Этот файл содержит ключевые пути конфигурации для работы проекта, включая:

Путь к языковой модели KenLM.
Путь к предобученной модели.
Путь для сохранения загруженных аудиофайлов.
Пример содержимого:

lm_path = "lm/zh_giga.no_cna_cmn.prune01244.klm"
pretrained_model_path = "pretrained/model.pth"
audio_save_path = "save_audio/"
#### 1.3. record.js
Этот файл отвечает за взаимодействие с микрофоном пользователя в браузере. Основные функции:

Начало записи аудио.
Остановка записи.
Воспроизведение записанного аудио.
Отправка записанного аудио на сервер для обработки.
#### 1.4. index.html
Это главный файл пользовательского интерфейса, предоставляющий следующие функции:

Выбор или запись аудиофайла.
Воспроизведение выбранного или записанного аудио.
Отправка аудиофайла на сервер.
Отображение результата распознавания текста.
### 2. Папки
#### 2.1. Папка save_audio
В этой папке хранятся загруженные пользователем аудиофайлы.

Пример:

save_audio/
├── audio1.wav
├── audio2.wav
#### 2.2. Папка pretrained
В этой папке хранятся предобученные модели:

model.pth: Основная предобученная модель на базе PyTorch.
best_model.pth: Лучший вариант модели (опционально).
#### 2.3. Папка lm
В этой папке хранится языковая модель KenLM:

zh_giga.no_cna_cmn.prune01244.klm: Языковая модель для улучшения качества распознавания текста.
#### 2.4. Папка static
В этой папке находятся статические ресурсы для веб-интерфейса:

record.js: Логика для записи, воспроизведения и отправки аудио.
### 3. Запуск проекта

Все находится в ветке 'server'.

### 4. Распознавание речи
Шаги распознавания
Пользователь загружает или записывает аудиофайл через веб-интерфейс.
Сервер принимает файл через API /masr/recognize.
Аудиофайл сохраняется в папку save_audio/.
Сервер вызывает предобученную модель и возвращает результат в виде текста.
5. Пример данных
Вход:
Аудиофайл (.wav, .mp3).
Выход:
Распознанный текст, например:

{
    "recognize text": "今天的天气很好",
    "code": 200,
    "message": "成功"
}

---
---
## Подготовка рамок и Docker ( Фу Цзухэ )
### models файл
Основная директория, предназначенная для хранения и управления файлами, связанными с моделями распознавания речи, построенными на основе конволюционных сетей с воротами в рамках данного проекта. В этой папке достигается четкое разделение структуры модели, функциональных расширений и оценки обучения благодаря тщательно организованной структуре файлов

#### 1.base.py
`base.py` - это файл, определяющий структуру базовой модели. Он содержит базовый класс `MASRModel`, который обеспечивает базовую структуру и общую функциональность для последующих моделей.

`MASRModel` служит базовым классом для модели распознавания речи, обеспечивая загрузку модели, перевод в режим обучения, предсказание (без специальной логики) и методы декодирования по умолчанию.

#### 2.conv.py
`conv.py` определяет специальную модель `GatedConv`, которая представляет собой модель распознавания речи на основе сверточных сетей (Gated Convolutional Networks), наследующих от `MASRModel`

`ConvBlock` служит основным конволюционным блоком в модели `GatedConv` и содержит конволюционный слой, функцию активации (`GLU`) и слой `Dropout`.

#### 3.trainable.py
В файле `trainable.py` определен класс `TrainableModel`, который наследуется от `MASRModel` и предоставляет дополнительные функции для модели, такие как обучение, тестирование, сохранение и загрузка.

### Развертывание проекта в docker
Упаковка прогнозирования и веб-функций проекта в docker. Подробности смотрите в файле README.md в ветке server.
